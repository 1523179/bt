
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>bt - Flexible Backtesting for Python &mdash; bt 0.1.2 documentation</title>
    
    <link rel="stylesheet" href="_static/css/klink.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="bt 0.1.2 documentation" href="#" />
    <link rel="next" title="bt - Flexible Backtesting for Python" href="" />
         
        <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
        
            <link rel="shortcut icon" href="_static/favicon.ico">
        
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Droid+Sans+Mono:400,500,700' rel='stylesheet' type='text/css'>
    
  </head>
  <body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="bt-flexible-backtesting-for-python">
<h1>bt - Flexible Backtesting for Python<a class="headerlink" href="#bt-flexible-backtesting-for-python" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-bt">
<h2>What is bt?<a class="headerlink" href="#what-is-bt" title="Permalink to this headline">¶</a></h2>
<p><strong>bt</strong> is a flexible backtesting framework for Python used to test quantitative
trading strategies. <strong>Backtesting</strong> is the process of testing a strategy over a given
data set. This framework allows you to easily create strategies that mix and match
different <a class="reference internal" href="bt.html#bt.core.Algo" title="bt.core.Algo"><tt class="xref py py-class docutils literal"><span class="pre">Algos</span></tt></a>. It aims to foster the creation of easily testable, re-usable and
flexible blocks of strategy logic to facilitate the rapid development of complex
trading strategies.</p>
<p>The goal: to save <strong>quants</strong> from re-inventing the wheel and let them focus on the
important part of the job - strategy development.</p>
<p><strong>bt</strong> is coded in <strong>Python</strong> and joins a vibrant and rich ecosystem for data analysis.
Numerous libraries exist for machine learning, signal processing and statistics and can be leveraged to avoid
re-inventing the wheel - something that happens all too often when using other
languages that don&#8217;t have the same wealth of high-quality, open-source projects.</p>
<p>bt is built atop <a class="reference external" href="https://github.com/pmorissette/ffn">ffn</a> - a financial function library for Python. Check it out!</p>
</div>
<div class="section" id="a-quick-example">
<h2>A Quick Example<a class="headerlink" href="#a-quick-example" title="Permalink to this headline">¶</a></h2>
<p>Here is a quick taste of bt:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># to see our plots</span>
<span class="c"># %pylab inline</span>

<span class="kn">import</span> <span class="nn">bt</span>
</pre></div>
</div>
<div class="section" id="a-simple-strategy-backtest">
<h3>A Simple Strategy Backtest<a class="headerlink" href="#a-simple-strategy-backtest" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s create a simple strategy. We will create a monthly rebalanced, long-only strategy where we place equal weights on each asset in our universe of assets.</p>
<p>First, we will download some data. By default, <a class="reference external" href="http://pmorissette.github.io/ffn/ffn.html#ffn.data.get" title="(in ffn v0.1)"><tt class="xref py py-func docutils literal"><span class="pre">bt.get</span> <span class="pre">(alias</span> <span class="pre">for</span> <span class="pre">ffn.get)</span></tt></a> downloads the Adjusted Close from Yahoo! Finance. We will download some data starting on January 1, 2010 for the purposes of this demo.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># fetch some data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;spy,agg&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s">&#39;2010-01-01&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="pynb-result highlight-python"><pre>               spy    agg
Date
2010-01-04  103.44  90.61
2010-01-05  103.71  91.02
2010-01-06  103.79  90.97
2010-01-07  104.23  90.86
2010-01-08  104.57  90.92

[5 rows x 2 columns]</pre>
</div>
<p>Once we have our data, we will create our strategy. The <a class="reference internal" href="bt.html#bt.core.Strategy" title="bt.core.Strategy"><tt class="xref py py-class docutils literal"><span class="pre">Strategy</span></tt></a> object contains the strategy logic by combining various <a class="reference internal" href="bt.html#bt.core.Algo" title="bt.core.Algo"><tt class="xref py py-class docutils literal"><span class="pre">Algos</span></tt></a>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># create the strategy</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
                       <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>
                       <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighEqually</span><span class="p">(),</span>
                       <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
</pre></div>
</div>
<p>Finally, we will create a <a class="reference internal" href="bt.html#bt.backtest.Backtest" title="bt.backtest.Backtest"><tt class="xref py py-class docutils literal"><span class="pre">Backtest</span></tt></a>, which is the logical combination of a strategy with a data set.</p>
<p>Once this is done, we can run the backtest and analyze the results.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># create a backtest and run it</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can analyze the results of our backtest. The <a class="reference internal" href="bt.html#bt.backtest.Result" title="bt.backtest.Result"><tt class="xref py py-class docutils literal"><span class="pre">Result</span></tt></a> object is a thin wrapper around <a class="reference external" href="http://pmorissette.github.io/ffn/ffn.html#ffn.core.GroupStats">ffn.GroupStats</a> that adds some helper methods.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># first let&#39;s see an equity curve</span>
<span class="n">res</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/intro_8_0.png" class="pynb" src="_images/intro_8_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># ok and what about some stats?</span>
<span class="n">res</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<div class="pynb-result highlight-python"><pre>Stat                 s1
-------------------  ----------
Start                2010-01-04
End                  2014-06-27

Total Return         55.58%
Daily Sharpe         1.33
CAGR                 10.38%
Max Drawdown         -7.83%

MTD                  1.03%
3m                   4.19%
6m                   5.72%
YTD                  5.48%
1Y                   13.97%
3Y (ann.)            10.60%
5Y (ann.)            10.38%
10Y (ann.)           10.38%
Since Incep. (ann.)  10.38%

Daily Sharpe         1.33
Daily Mean (ann.)    10.17%
Daily Vol (ann.)     7.62%
Daily Skew           -0.38
Daily Kurt           4.19
Best Day             2.48%
Worst Day            -3.11%

Monthly Sharpe       1.60
Monthly Mean (ann.)  10.25%
Monthly Vol (ann.)   6.40%
Monthly Skew         -0.13
Monthly Kurt         0.24
Best Month           5.70%
Worst Month          -3.40%

Yearly Sharpe        2.07
Yearly Mean          8.71%
Yearly Vol           4.22%
Yearly Skew          0.75
Yearly Kurt          -1.83
Best Year            14.10%
Worst Year           5.23%

Avg. Drawdown        -0.75%
Avg. Drawdown Days   12.04
Avg. Up Month        1.76%
Avg. Down Month      -1.44%
Win Year %           100.00%
Win 12m %            100.00%</pre>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># ok and how does the return distribution look like?</span>
<span class="n">res</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/intro_10_0.png" class="pynb" src="_images/intro_10_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># and just to make sure everything went along as planned, let&#39;s plot the security weights over time</span>
<span class="n">res</span><span class="o">.</span><span class="n">plot_security_weights</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/intro_11_0.png" class="pynb" src="_images/intro_11_0.png" />
</div>
<div class="section" id="modifying-a-strategy">
<h3>Modifying a Strategy<a class="headerlink" href="#modifying-a-strategy" title="Permalink to this headline">¶</a></h3>
<p>Now what if we ran this strategy weekly and also used some risk parity style approach by using weights that are proportional to the inverse of each asset&#8217;s volatility? Well, all we have to do is plug in some different algos. See below:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># create our new strategy</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunWeekly</span><span class="p">(),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighInvVol</span><span class="p">(),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>

<span class="c"># now let&#39;s test it with the same data set. We will also compare it with our first backtest.</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">res2</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">test2</span><span class="p">)</span>

<span class="n">res2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/intro_13_0.png" class="pynb" src="_images/intro_13_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">res2</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<div class="pynb-result highlight-python"><pre>Stat                 s1          s2
-------------------  ----------  ----------
Start                2010-01-04  2010-01-04
End                  2014-06-27  2014-06-27

Total Return         53.57%      29.24%
Daily Sharpe         1.29        1.73
CAGR                 10.06%      5.90%
Max Drawdown         -7.83%      -4.06%

MTD                  1.03%       0.37%
3m                   4.19%       2.71%
6m                   5.72%       4.28%
YTD                  5.48%       4.18%
1Y                   13.97%      8.49%
3Y (ann.)            10.60%      5.42%
5Y (ann.)            10.06%      5.90%
10Y (ann.)           10.06%      5.90%
Since Incep. (ann.)  10.06%      5.90%

Daily Sharpe         1.29        1.73
Daily Mean (ann.)    9.88%       5.79%
Daily Vol (ann.)     7.68%       3.35%
Daily Skew           -0.39       -0.18
Daily Kurt           4.01        3.21
Best Day             2.48%       1.20%
Worst Day            -3.11%      -1.13%

Monthly Sharpe       1.62        2.19
Monthly Mean (ann.)  10.41%      6.11%
Monthly Vol (ann.)   6.41%       2.79%
Monthly Skew         -0.15       -0.64
Monthly Kurt         0.22        0.17
Best Month           5.70%       1.90%
Worst Month          -3.40%      -1.49%

Yearly Sharpe        2.07        3.54
Yearly Mean          8.71%       4.95%
Yearly Vol           4.21%       1.40%
Yearly Skew          0.75        1.81
Yearly Kurt          -1.83       3.30
Best Year            14.10%      7.01%
Worst Year           5.23%       4.00%

Avg. Drawdown        -0.77%      -0.37%
Avg. Drawdown Days   12.33       11.13
Avg. Up Month        1.78%       0.85%
Avg. Down Month      -1.44%      -0.66%
Win Year %           100.00%     100.00%
Win 12m %            100.00%     97.67%</pre>
</div>
<p>As you can see, the strategy logic is easy to understand and more importantly,
easy to modify.  The idea of using simple, composable Algos to create strategies is one of the
core building blocks of bt.</p>
</div>
</div>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul>
<li><dl class="first docutils">
<dt><strong>Tree Structure</strong></dt>
<dd><p class="first last"><a class="reference internal" href="tree.html"><em>The tree structure</em></a> facilitates the construction and composition of complex algorithmic trading
strategies that are modular and re-usable. Furthermore, each tree <a class="reference internal" href="bt.html#bt.core.Node" title="bt.core.Node"><tt class="xref py py-class docutils literal"><span class="pre">Node</span></tt></a>
has its own <a class="reference internal" href="bt.html#bt.core.Node.prices" title="bt.core.Node.prices"><tt class="xref py py-func docutils literal"><span class="pre">price</span> <span class="pre">index</span></tt></a> that can be
used by Algos to determine a Node&#8217;s allocation.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Algorithm Stacks</strong></dt>
<dd><p class="first last"><a class="reference internal" href="bt.html#bt.core.Algo" title="bt.core.Algo"><tt class="xref py py-class docutils literal"><span class="pre">Algos</span></tt></a> and <a class="reference internal" href="bt.html#bt.core.AlgoStack" title="bt.core.AlgoStack"><tt class="xref py py-class docutils literal"><span class="pre">AlgoStacks</span></tt></a> are
another core feature that facilitate the creation of modular and re-usable strategy
logic. Due to their modularity, these logic blocks are also easier to test -
an important step in building robust financial solutions.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Charting and Reporting</strong></dt>
<dd><p class="first last">bt also provides many useful charting functions that help visualize backtest
results. We also plan to add more charts, tables and report formats in the future,
such as automatically generated PDF reports.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Detailed Statistics</strong></dt>
<dd><p class="first last">Furthermore, bt calculates a bunch of stats relating to a backtest and offers a quick way to compare
these various statistics across many different backtests via <tt class="xref py py-class docutils literal"><span class="pre">Results'</span></tt> display methods.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="roadmap">
<h2>Roadmap<a class="headerlink" href="#roadmap" title="Permalink to this headline">¶</a></h2>
<p>Future development efforts will focus on:</p>
<ul>
<li><dl class="first docutils">
<dt><strong>Speed</strong></dt>
<dd><p class="first last">Due to the flexible nature of bt, a trade-off had to be made between
usability and performance. Usability will always be the priority, but we do
wish to enhance the performance as much as possible.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Algos</strong></dt>
<dd><p class="first last">We will also be developing more algorithms as time goes on. We also
encourage anyone to contribute their own algos as well.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Charting and Reporting</strong></dt>
<dd><p class="first last">This is another area we wish to constantly improve on
as reporting is an important aspect of the job. Charting and reporting also
facilitate finding bugs in strategy logic.</p>
</dd>
</dl>
</li>
</ul>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


          </div>
        </div>
      </div>
        <aside>

            
            <a href="#" id="logo" title=bt><img class="logo" src="_static/logo.png" width="150px" height="150px" title=bt /></a>
            
            
            <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href=""> Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-bt">What is bt?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-quick-example">A Quick Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#roadmap">Roadmap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html"> Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="algos.html"> All About Algos</a></li>
<li class="toctree-l1"><a class="reference internal" href="tree.html"> The Tree Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html"> Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="bt.html"> API</a></li>
</ul>


            
            <ul>
                <li><a href="https://github.com/pmorissette/bt">Github</a></li>
            </ul>
            
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </aside>
    
      <div class="clearer"></div>
    </div>
        <div class="footer">
            bt was created by Philippe Morissette. If you find a bug, please <a href="https://github.com/pmorissette/bt/issues/new" title="Open a new issue on Github">submit an issue</a> on Github.
        </div>

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-52308448-3', 'auto');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
        
  </body>
</html>